---
import PageLayout from "../../layouts/PageLayout.astro";
import { getLangFromUrl, useTranslations } from "src/i18n/utils";
import { getCollection } from "astro:content";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export function getStaticPaths() {
	return [{ params: { lang: "en" } }, { params: { lang: "zh-TW" } }];
}

// Fetch blog posts for current language and attach category entries to each post
const rawPosts = (await getCollection("act"))
	.filter((post) => post.id.startsWith(lang + "/"))
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<PageLayout>
	<h1 class="text-2xl font-semibold mb-4">{t("cat.acts")}</h1>
	<div class="gap-4 grid sm:grid-cols-[repeat(auto-fill,minmax(300px,1fr))]">
		{
			rawPosts.map((post) => (
				<a
					href={`/${lang}/act/${post.id.replace(/^.+?\//, "").replace(/\.(md|mdx)$/, "")}`}
					class="border-accent p-4 rounded-xl hover:border-primary/25 border group transition-colors flex gap-4 items-start hover:bg-gray-50 dark:hover:bg-gray-800"
				>
					<div class="flex shrink-0 items-center justify-center text-2xl size-12 text-center rounded-lg bg-gray-100 dark:bg-gray-800 group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
						<span class="text-2xl">{post.data.emoji}</span>
					</div>
					<div>
						<h2 class="text-lg font-semibold">{post.data.title}</h2>
						<p class="text-gray-600 dark:text-gray-400 text-sm">
							{post.data.date.toLocaleDateString(lang, {
								year: "numeric",
								month: "long",
								day: "numeric",
							})}
						</p>
					</div>
				</a>
			))
		}
	</div>
</PageLayout>

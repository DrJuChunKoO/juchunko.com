---
interface Props {
	key: string;
	text?: string;
	actionText?: string;
	actionHref?: string;
	target?: "_self" | "_blank";
	closable?: boolean;
	class?: string;
}
const { key: storageKey, text, actionText, actionHref, target = "_self", closable = true } = Astro.props as Props;

const id = `callout-${storageKey}`;
---

<div
	id={id}
	role="region"
	aria-label="網站公告"
	class="relative mx-auto flex w-full items-center gap-3 rounded-lg bg-gray-50 p-3 md:p-4 dark:bg-white/5"
	class:list={Astro.props.class}
	data-callout
>
	<div class="flex min-w-0 flex-1 items-center gap-3">
		<div class="text-foreground/90 min-w-0 text-sm leading-snug">
			{text ? <span set:html={text} /> : <slot />}
		</div>
	</div>
	{
		actionHref && actionText && (
			<a
				href={actionHref}
				target={target}
				class="bg-primary text-primary-foreground inline-flex h-9 shrink-0 items-center justify-center rounded-md px-3 text-sm font-medium transition-opacity hover:opacity-90"
			>
				{actionText}
			</a>
		)
	}
	{
		closable && (
			<button
				type="button"
				class="hover:text-foreground text-foreground/60 flex size-9 cursor-pointer items-center justify-center rounded-md transition-colors hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-white/5 dark:active:bg-white/10"
				aria-label="關閉公告"
				title="關閉"
				data-callout-close
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="18"
					height="18"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					aria-hidden="true"
				>
					<path d="M18 6L6 18" />
					<path d="M6 6l12 12" />
				</svg>
			</button>
		)
	}
</div>

<script define:vars={{ id, storageKey }}>
	(function () {
		const el = document.getElementById(id);
		if (!el) return;
		const STORAGE_KEY = "callout:" + storageKey;
		try {
			if (localStorage.getItem(STORAGE_KEY) === "closed") {
				el.remove();
				return;
			}
		} catch {}
		const btn = el.querySelector("[data-callout-close]");
		if (btn) {
			btn.addEventListener(
				"click",
				() => {
					try {
						localStorage.setItem(STORAGE_KEY, "closed");
					} catch {}
					el.remove();
				},
				{ once: true },
			);
		}
	})();
</script>
